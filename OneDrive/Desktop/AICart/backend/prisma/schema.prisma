generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  admin
  user
}

model users {
  id           String   @id @default(uuid()) @db.VarChar(36)
  name         String
  email        String   @unique
  password_hash String
  role         Role
  avatar_url   String?  @db.Text
  plan_id      String?  @db.VarChar(36)
  credits      Int      @default(0)
  metadata     Json?
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
  plans        plans?   @relation(fields: [plan_id], references: [id])
  admin_settings admin_settings[]
  admin_activity_logs admin_activity_logs[]
  subscriptions subscriptions[]
  payment_methods payment_methods[]
  invoices      invoices[]
  projects      projects[]
  assets        assets[]
  generation_jobs generation_jobs[]
  user_usage_logs user_usage_logs[]
  ai_models     ai_models[]
  analytics_events analytics_events[]
  team_members team_members[]
}

model role_permissions {
  id         String   @id @default(uuid()) @db.VarChar(36)
  role       Role
  permission String
  created_at DateTime @default(now())
}

model admin_settings {
  id         String   @id @default(uuid()) @db.VarChar(36)
  key        String   @unique
  value      Json
  updated_by String   @db.VarChar(36)
  updated_at DateTime @updatedAt
  user       users    @relation(fields: [updated_by], references: [id])
}

model admin_activity_logs {
  id         String   @id @default(uuid()) @db.VarChar(36)
  admin_id   String   @db.VarChar(36)
  action     String
  details    Json?
  ip_address String?
  created_at DateTime @default(now())
  admin      users    @relation(fields: [admin_id], references: [id])
}

model plans {
  id                String   @id @default(uuid()) @db.VarChar(36)
  name              String
  price             Decimal  @db.Decimal(10,2)
  credits_per_month Int
  max_users         Int
  features          Json?
  created_at        DateTime @default(now())
  users             users[]
  subscriptions     subscriptions[]
}

model subscriptions {
  id                  String   @id @default(uuid()) @db.VarChar(36)
  user_id             String   @db.VarChar(36)
  plan_id             String   @db.VarChar(36)
  status              String
  current_period_start DateTime
  current_period_end   DateTime
  cancel_at           DateTime?
  created_at          DateTime @default(now())
  user                users    @relation(fields: [user_id], references: [id])
  plan                plans    @relation(fields: [plan_id], references: [id])
  invoices            invoices[]
}

model payment_methods {
  id            String   @id @default(uuid()) @db.VarChar(36)
  user_id       String   @db.VarChar(36)
  provider      String
  provider_id   String
  last4         String
  brand         String
  expiry_month  Int
  expiry_year   Int
  created_at    DateTime @default(now())
  user          users    @relation(fields: [user_id], references: [id])
}

model invoices {
  id               String   @id @default(uuid()) @db.VarChar(36)
  user_id          String   @db.VarChar(36)
  subscription_id  String   @db.VarChar(36)
  amount           Decimal  @db.Decimal(10,2)
  currency         String
  status           String
  invoice_url      String
  created_at       DateTime @default(now())
  user             users    @relation(fields: [user_id], references: [id])
  subscription     subscriptions @relation(fields: [subscription_id], references: [id])
}

model projects {
  id          String   @id @default(uuid()) @db.VarChar(36)
  user_id     String   @db.VarChar(36)
  name        String
  description String?
  mode        String
  thumbnail_url String? @db.Text
  metadata    Json?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  user        users    @relation(fields: [user_id], references: [id])
  scenes      scenes[]
  assets      assets[]
  generation_jobs generation_jobs[]
}

model scenes {
  id                    String   @id @default(uuid()) @db.VarChar(36)
  project_id            String   @db.VarChar(36)
  scene_prompt          String?
  lighting_settings     Json?
  camera_settings       Json?
  composition_settings  Json?
  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt
  project               projects @relation(fields: [project_id], references: [id])
}

model assets {
  id          String   @id @default(uuid()) @db.VarChar(36)
  user_id     String?  @db.VarChar(36)
  project_id  String?  @db.VarChar(36)
  type        String
  url         String   @db.LongText
  metadata    Json?
  created_at  DateTime @default(now())
  user        users?   @relation(fields: [user_id], references: [id])
  project     projects? @relation(fields: [project_id], references: [id])
}

model generation_jobs {
  id           String   @id @default(uuid()) @db.VarChar(36)
  user_id      String   @db.VarChar(36)
  project_id   String?  @db.VarChar(36)
  job_type     String
  status       String
  prompt       String?
  input_assets Json?
  num_outputs  Int      @default(1)
  created_at   DateTime @default(now())
  completed_at DateTime?
  user         users    @relation(fields: [user_id], references: [id])
  project      projects? @relation(fields: [project_id], references: [id])
  outputs      generation_outputs[]
}

model generation_outputs {
  id        String   @id @default(uuid()) @db.VarChar(36)
  job_id    String   @db.VarChar(36)
  image_url String   @db.Text
  metadata  Json?
  created_at DateTime @default(now())
  job       generation_jobs @relation(fields: [job_id], references: [id])
}

model user_usage_logs {
  id           String   @id @default(uuid()) @db.VarChar(36)
  user_id      String   @db.VarChar(36)
  type         String
  credits_used Int
  metadata     Json?
  created_at   DateTime @default(now())
  user         users    @relation(fields: [user_id], references: [id])
}

model ai_models {
  id             String                 @id @default(uuid()) @db.VarChar(36)
  user_id        String?                @db.VarChar(36)
  name           String
  type           String
  status         String
  model_url      String?                @db.LongText
  metadata       Json?
  created_at     DateTime               @default(now())
  user           users?                 @relation(fields: [user_id], references: [id])
  category_links model_category_links[]
}

model model_categories {
  id             String   @id @default(uuid()) @db.VarChar(36)
  scope          String
  category_group String
  name           String
  slug           String   @unique
  description    String?
  created_at     DateTime @default(now())
  model_links    model_category_links[]

  @@index([scope, category_group])
}

model model_category_links {
  id           String   @id @default(uuid()) @db.VarChar(36)
  model_id     String   @db.VarChar(36)
  category_id  String   @db.VarChar(36)
  assigned_at  DateTime @default(now())
  model        ai_models        @relation(fields: [model_id], references: [id], onDelete: Cascade)
  category     model_categories @relation(fields: [category_id], references: [id], onDelete: Cascade)

  @@unique([model_id, category_id])
  @@index([category_id])
}

// avatars model removed; using ai_models table for storing avatars/models

model analytics_events {
  id         String   @id @default(uuid()) @db.VarChar(36)
  user_id    String?  @db.VarChar(36)
  event_name String
  properties Json?
  created_at DateTime @default(now())
  user       users?   @relation(fields: [user_id], references: [id])
}

model props_library {
  id        String   @id @default(uuid()) @db.VarChar(36)
  name      String
  category  String
  image_url String?  @db.Text
  metadata  Json?
  created_at DateTime @default(now())
}

model backgrounds_library {
  id        String   @id @default(uuid()) @db.VarChar(36)
  name      String
  category  String
  image_url String?  @db.Text
  metadata  Json?
  created_at DateTime @default(now())
}

model library_categories {
  id         String   @id @default(uuid()) @db.VarChar(36)
  type       String
  name       String
  bg_color   String?
  accent_color String?
  created_at DateTime @default(now())
  @@unique([type, name])
}

model scene_library {
  id           String   @id @default(uuid()) @db.VarChar(36)
  name         String
  category     String
  mood         String?
  description  String?
  image_url    String?  @db.LongText
  metadata     Json?
  tags         Json?
  is_generated Boolean  @default(false)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  @@index([category])
}

model style_presets {
  id        String   @id @default(uuid()) @db.VarChar(36)
  name      String
  category  String
  config    Json
  created_at DateTime @default(now())
}

model teams {
  id        String   @id @default(uuid()) @db.VarChar(36)
  name      String
  created_at DateTime @default(now())
  members   team_members[]
}

model team_members {
  id        String   @id @default(uuid()) @db.VarChar(36)
  team_id   String   @db.VarChar(36)
  user_id   String   @db.VarChar(36)
  role      String
  created_at DateTime @default(now())
  team      teams    @relation(fields: [team_id], references: [id])
  user      users    @relation(fields: [user_id], references: [id])
}
