CREATE DATABASE IF NOT EXISTS aikart;
USE aikart;

CREATE TABLE users (
  id            CHAR(36) PRIMARY KEY,
  name          VARCHAR(100),
  email         VARCHAR(150) UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  role          ENUM('admin', 'user') DEFAULT 'user',
  avatar_url    TEXT,
  plan_id       CHAR(36),
  credits       INT DEFAULT 0,
  metadata      JSON,
  created_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);


CREATE TABLE role_permissions (
  id          CHAR(36) PRIMARY KEY,
  role        ENUM('admin', 'user'),
  permission  VARCHAR(255),
  created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE admin_settings (
  id          CHAR(36) PRIMARY KEY,
  setting_key VARCHAR(255) UNIQUE,
  value_json  JSON,
  updated_by  CHAR(36),
  updated_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE admin_activity_logs (
  id          CHAR(36) PRIMARY KEY,
  admin_id    CHAR(36),
  action      VARCHAR(255),
  details     JSON,
  ip_address  VARCHAR(50),
  created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE plans (
  id                  CHAR(36) PRIMARY KEY,
  name                VARCHAR(100),
  price               DECIMAL(10,2),
  credits_per_month   INT,
  max_users           INT,
  features            JSON,
  created_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE subscriptions (
  id                    CHAR(36) PRIMARY KEY,
  user_id               CHAR(36),
  plan_id               CHAR(36),
  status                ENUM('active','cancelled','expired'),
  current_period_start  TIMESTAMP,
  current_period_end    TIMESTAMP,
  cancel_at             TIMESTAMP NULL,
  created_at            TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE payment_methods (
  id            CHAR(36) PRIMARY KEY,
  user_id       CHAR(36),
  provider      VARCHAR(50),
  provider_id   VARCHAR(255),
  last4         CHAR(4),
  brand         VARCHAR(50),
  expiry_month  INT,
  expiry_year   INT,
  created_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE invoices (
  id               CHAR(36) PRIMARY KEY,
  user_id          CHAR(36),
  subscription_id  CHAR(36),
  amount           DECIMAL(10,2),
  currency         VARCHAR(10),
  status           ENUM('paid','failed','pending'),
  invoice_url      TEXT,
  created_at       TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE projects (
  id            CHAR(36) PRIMARY KEY,
  user_id       CHAR(36),
  name          VARCHAR(255),
  description   TEXT,
  mode          ENUM('apparel','product','design','reimagine'),
  thumbnail_url TEXT,
  metadata      JSON,
  created_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE scenes (
  id                      CHAR(36) PRIMARY KEY,
  project_id              CHAR(36),
  scene_prompt            TEXT,
  lighting_settings       JSON,
  camera_settings         JSON,
  composition_settings    JSON,
  created_at              TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at              TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE assets (
  id            CHAR(36) PRIMARY KEY,
  user_id       CHAR(36) NULL,
  project_id    CHAR(36),
  type          ENUM('model','apparel','product','background','prop','reference','output'),
  url           TEXT,
  metadata      JSON,
  created_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE generation_jobs (
  id              CHAR(36) PRIMARY KEY,
  user_id         CHAR(36),
  project_id      CHAR(36),
  job_type        ENUM('image','animation','avatar','upscale'),
  status          ENUM('queued','processing','completed','failed'),
  prompt          TEXT,
  input_assets    JSON,
  num_outputs     INT,
  created_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  completed_at    TIMESTAMP NULL
);

CREATE TABLE generation_outputs (
  id            CHAR(36) PRIMARY KEY,
  job_id        CHAR(36),
  image_url     TEXT,
  metadata      JSON,
  created_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE user_usage_logs (
  id            CHAR(36) PRIMARY KEY,
  user_id       CHAR(36),
  type          ENUM('image','animation','avatar','upscale','export'),
  credits_used  INT,
  metadata      JSON,
  created_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE ai_models (
  id          CHAR(36) PRIMARY KEY,
  user_id     CHAR(36) NULL,
  name        VARCHAR(255),
  type        ENUM('avatar','custom','fashion','product'),
  status      ENUM('training','ready','failed'),
  model_url   TEXT,
  metadata    JSON,
  created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE model_categories (
  id          CHAR(36) PRIMARY KEY,
  scope       VARCHAR(100),
  category_group   VARCHAR(100),
  name        VARCHAR(255),
  slug        VARCHAR(255) UNIQUE,
  description TEXT,
  created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE model_category_links (
  id           CHAR(36) PRIMARY KEY,
  model_id     CHAR(36),
  category_id  CHAR(36),
  assigned_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE analytics_events (
  id          CHAR(36) PRIMARY KEY,
  user_id     CHAR(36),
  event_name  VARCHAR(255),
  properties  JSON,
  created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE props_library (
  id          CHAR(36) PRIMARY KEY,
  name        VARCHAR(255),
  category    VARCHAR(255),
  image_url   TEXT,
  metadata    JSON,
  created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE backgrounds_library (
  id          CHAR(36) PRIMARY KEY,
  name        VARCHAR(255),
  category    VARCHAR(255),
  image_url   TEXT,
  metadata    JSON,
  created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE style_presets (
  id          CHAR(36) PRIMARY KEY,
  name        VARCHAR(255),
  category    VARCHAR(255),
  config      JSON,
  created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE teams (
  id          CHAR(36) PRIMARY KEY,
  name        VARCHAR(255),
  created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE team_members (
  id          CHAR(36) PRIMARY KEY,
  team_id     CHAR(36),
  user_id     CHAR(36),
  role        VARCHAR(100),
  created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


